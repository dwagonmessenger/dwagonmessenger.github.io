<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trystero P2P Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/trystero@latest/browser.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        #messages { border: 1px solid #ccc; padding: 10px; width: 300px; height: 200px; overflow-y: auto; margin: 10px auto; }
        input, button { margin-top: 10px; }
    </style>
</head>
<body>

    <h2>Trystero P2P Chat</h2>
    <label for="room">Nom du salon :</label>
    <input type="text" id="room" placeholder="Nom du salon" />
    <button onclick="joinRoom()">Rejoindre</button>

    <div id="chat" style="display: none;">
        <h3>Salon: <span id="roomName"></span></h3>
        <div id="messages"></div>
        <input type="text" id="messageInput" placeholder="Ã‰cris un message" />
        <button onclick="sendMessage()">Envoyer</button>
    </div>

    <script>
        let room, sendMessageFn;

        function joinRoom() {
            const roomName = document.getElementById("room").value.trim();
            if (!roomName) return alert("Veuillez entrer un nom de salon !");
            
            const { joinRoom } = Trystero.browser({ appId: "test-app" });
            room = joinRoom(roomName);

            document.getElementById("roomName").textContent = roomName;
            document.getElementById("chat").style.display = "block";

            sendMessageFn = room.broadcast;
            room.onMessage((message) => {
                displayMessage(message);
            });
        }

        function sendMessage() {
            const message = document.getElementById("messageInput").value.trim();
            if (!message) return;
            
            sendMessageFn(message);
            displayMessage(`Moi: ${message}`);
            document.getElementById("messageInput").value = "";
        }

        function displayMessage(msg) {
            const messagesDiv = document.getElementById("messages");
            const p = document.createElement("p");
            p.textContent = msg;
            messagesDiv.appendChild(p);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
    </script>

</body>
</html>
